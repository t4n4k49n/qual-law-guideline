schema: qai.parser_profile.v1
id: pics_annexes_default_v3
title: "PIC/S PE 009-17 Annexes (full document) markers with dispatch and fallback refine"
applies_to:
  family: PICS
  jurisdiction: INTL
  defaults: false
language: en
source_label: "PIC/S"
context_root_kind: annex
structural_kinds: [annex]

preprocess:
  skip_blocks:
    - start_regex: '(?i)^\s*TABLE\s+OF\s+CONTENTS?\s*$'
      end_regex: '^\s*ANNEX\s+1(?:\s+[A-Z][A-Z\s]{3,})?\s*$'
      include_start: false
      include_end: true
      max_lines: 4000

  drop_line_regexes:
    - '(?i)^\s*PE\s*009-17\s*\(Annexes\)\s*-\s*(?:\d{1,3}|[ivxlcdm]+)\s*-\s*25\s+August\s+2023\s*$'
    - '^\s*-\s*(?:\d{1,3}|[ivxlcdm]+)\s*-\s*$'
    - '^\s*\d{1,3}\s*$'
    - '(?i)^\s*web\s+site:\s*https?://\S+\s*$'
    - '^\s*Annex\s+\d+[A-Z]?\s+[A-Za-z].{0,200}\s*$'

  strip_inline_regexes:
    - '(?i)(?<=\S)Annex\s+\d+[A-Z]?\s+[A-Za-z].{0,200}$'
    - '[\x00-\x1F]'

  merge_structural_heading_continuations:
    enabled: true
    kinds: [annex]
    max_next_line_len: 220
    max_merge_lines: 4
    max_blank_lookahead: 3

  drop_repeated_structural_headers:
    enabled: true
    kinds: [annex]

marker_types:
  - id: annex
    kind: annex
    kind_raw: "ANNEX"
    match: '(?i)^\s*ANNEX\s+(?P<n>\d+[A-Z]?)\b(?:\s+|$)'
    num_group: n

structure:
  root:
    children: [annex]
  annex:
    children: [note, history]
  note:
    children: []
  history:
    children: []

compound_prefix:
  enabled: false
  max_depth: 1

postprocess:
  refine_subtrees:
    enabled: true
    kind: annex
    key: num
    dispatch_by_num:
      "1": "pics_annex1_default_v2"
      "2A": "pics_annex2a_default_v1"
      "11": "pics_annex11_default_v1"
      "15": "pics_annex15_default_v1"
    fallback_profile_id: "pics_annex_generic_default_v1"
    keep_unmapped: true
