schema: qai.parser_profile.v1
id: who_lbm_3rd_default_v3
title: WHO LBM 3rd (2004) markers (skip TOC block + parse parts + drop repeated headers)
applies_to:
  family: WHO_LBM
  jurisdiction: WHO
  defaults: true
language: en
source_label: "WHO LBM"
context_root_kind: chapter
structural_kinds: ["part", "chapter", "annex"]

preprocess:
  skip_blocks:
    - start_regex: '(?i)^\s*(?:[A-Z]{2,10}\.)?Contents\s*$'
      end_regex: '(?i)^Foreword\s*$'
      include_start: false
      include_end: true
      max_lines: 1200
  drop_line_regexes:
    - '^(?:•\s*[0-9ivxlcdm]+\s*•)+$'
    - '^\f$'
  strip_inline_regexes:
    - '(?i)\bLABORATORY BIOSAFETY MANUAL\b'
    - '•\s*[0-9ivxlcdm]+\s*•'
  drop_repeated_structural_headers:
    enabled: true
    kinds: ["part", "chapter", "annex"]
  use_indent_dedent: true
  dedent_pop_kinds: ["subitem", "item"]

marker_types:
  - id: part_roman
    kind: part
    kind_raw: "PART"
    match: '(?i)^PART\s+(?P<n>[IVXLCDM]+)\.\s+'
    num_group: n
  - id: chapter_num_dot
    kind: chapter
    kind_raw: "1."
    match: '^(?P<n>\d{1,2})\.\s+(?=[^.]{3,120}\s*$)(?!.*\b(must|should|shall|may)\b)'
    num_group: n
  - id: annex
    kind: annex
    kind_raw: "Annex"
    match: '(?i)^Annex\s+(?P<n>\d+)\b'
    num_group: n
  - id: item_num_dot
    kind: item
    kind_raw: "1."
    match: '^(?P<n>\d{1,3})\.\s+'
    num_group: n
  - id: item_alpha_upper_dot
    kind: item
    kind_raw: "A."
    match: '^(?P<n>[A-Z])\.\s+'
    num_group: n
  - id: bullet
    kind: subitem
    kind_raw: "•"
    match: '^[•]\s+'

structure:
  root:
    children: [part, chapter, annex]
  part:
    children: [chapter, item, subitem, note, history]
  chapter:
    children: [item, subitem, note, history]
  annex:
    children: [item, subitem, note, history]
  item:
    children: [subitem, note, history]
  subitem:
    children: [note, history]
  note:
    children: []
  history:
    children: []

compound_prefix:
  enabled: false
  max_depth: 1
